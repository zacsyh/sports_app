# 快乐健系统架构设计

## 1. 概述
本文档描述了"快乐健"应用的系统架构设计，包括模块划分、数据模型、存储结构和UI/UX架构。

## 2. 技术栈
- 平台：Web (PWA)
- 语言：JavaScript/TypeScript
- 框架：React.js (推荐) 或 Vue.js
- 本地存储：
  - localStorage：用户设置和简单配置
  - IndexedDB：健身项目数据和复杂结构
- 构建工具：
  - Vite 或 Webpack
- 依赖库：
  - Dexie.js：IndexedDB的封装库
  - React Router：页面路由管理

## 3. 模块划分

### 3.1 核心模块

#### 1. 用户管理模块
- 功能：处理用户设置、偏好配置和应用状态管理
- 职责：
  - 管理用户配置信息
  - 处理应用主题、语言等设置
  - 管理用户登录状态（如果有）

#### 2. 健身项目管理模块
- 功能：核心业务逻辑模块，处理健身项目的全生命周期
- 职责：
  - 创建、编辑、删除健身项目
  - 管理两种项目模式（Sets×reps 和 Total count/weight）
  - 项目状态管理（进行中、已完成、已归档）

#### 3. 数据存储模块
- 功能：统一的数据访问层，封装所有数据持久化操作
- 职责：
  - 使用localStorage管理用户设置
  - 使用IndexedDB管理项目数据、成就记录等
  - 提供统一的数据访问接口
  - 处理数据的增删改查操作

#### 4. 提醒通知模块
- 功能：管理应用内所有提醒和通知
- 职责：
  - 设置和管理整体项目提醒（每日固定时间）
  - 设置和管理个体项目提醒（项目截止时间）
  - 集成浏览器通知API
  - 处理提醒触发和用户交互

#### 5. 成长记录模块
- 功能：记录用户健身历程和成就
- 职责：
  - 记录项目完成历史
  - 统计用户健身数据
  - 管理成就系统
  - 提供数据可视化支持

### 3.2 功能模块

#### 1. 项目创建与编辑功能
- 集成在健身项目管理模块中
- 提供两种模式的表单界面
- 数据验证和错误处理

#### 2. 实时跟踪与状态更新功能
- 集成在健身项目管理模块中
- 提供实时计数器和状态更新界面
- 处理用户交互和数据保存

#### 3. 多维度提醒系统功能
- 集成在提醒通知模块中
- 提供提醒设置界面
- 管理提醒规则和触发逻辑

#### 4. 成就与激励系统功能
- 集成在成长记录模块中
- 设计成就规则和奖励机制
- 提供成就展示界面

#### 5. 数据可视化展示功能
- 集成在成长记录模块中
- 提供图表和统计数据展示
- 支持数据导出功能

## 4. 数据模型设计

### 4.1 用户设置模型
- 用户偏好设置
  - theme: String (主题设置)
  - language: String (语言设置)
  - notificationEnabled: Boolean (通知开关)
  - dailyReminderTime: String (每日提醒时间)
  - autoSaveProgress: Boolean (自动保存进度)
- 应用配置信息
  - firstLaunch: Boolean (首次启动标识)
  - lastSyncTime: Long (最后同步时间，预留)
  - appVersion: String (应用版本)

### 4.2 健身项目模型
#### 项目基础信息
- id: String (唯一标识符)
- name: String (项目名称)
- description: String (项目描述)
- type: Enum (项目类型：SETS_REPS 或 TOTAL_COUNT)
- createdAt: Long (创建时间)
- updatedAt: Long (更新时间)
- status: Enum (状态：ACTIVE, COMPLETED, ARCHIVED)

#### Sets×Reps模式数据结构
- sets: Int (设定组数)
- repsPerSet: Int (每组次数)
- completedSets: List<Int> (已完成的组数记录，记录每组实际完成次数)

#### Total count/weight模式数据结构
- targetCount: Int (目标次数)
- targetWeight: Double (目标重量，可选)
- currentCount: Int (当前完成次数)
- history: List<ProgressRecord> (进度历史记录)

#### 进度记录模型
- timestamp: Long (时间戳)
- count: Int (完成次数)
- weight: Double (重量，可选)

### 4.3 提醒模型
#### 整体项目提醒
- enabled: Boolean (是否启用)
- time: String (提醒时间，格式 HH:mm)
- daysOfWeek: List<Int> (每周提醒的天数，1-7代表周一到周日)

#### 个体项目提醒
- projectId: String (关联的项目ID)
- enabled: Boolean (是否启用)
- deadline: Long (截止时间戳)
- remindBefore: Int (提前分钟数)

### 4.4 成长记录模型
#### 成就数据
- id: String (成就ID)
- name: String (成就名称)
- description: String (成就描述)
- unlockedAt: Long (解锁时间)
- criteria: String (解锁条件)

#### 统计信息
- totalProjectsCompleted: Int (完成项目总数)
- totalRepsCompleted: Int (完成总次数)
- totalSetsCompleted: Int (完成总组数)
- weeklyStats: List<WeeklyStat> (周统计数据)
- monthlyStats: List<MonthlyStat> (月统计数据)

#### 周统计数据
- weekStart: Long (周开始时间)
- projectsCompleted: Int (本周完成项目数)
- repsCompleted: Int (本周完成次数)

#### 月统计数据
- monthStart: Long (月开始时间)
- projectsCompleted: Int (本月完成项目数)
- repsCompleted: Int (本月完成次数)

## 5. 存储结构设计

### 5.1 localStorage存储
- 存储内容：用户设置模型中的所有字段
- 存储格式：JSON格式的键值对

### 5.2 IndexedDB存储
使用IndexedDB存储所有复杂的数据结构，包括健身项目数据、用户成就数据、成长记录数据和提醒数据。

#### 数据库信息
- 数据库名：fitness_tracker
- 存储位置：浏览器本地存储
- 数据库版本：1 (初始版本)

#### 数据库表结构
1. **健身项目表 (fitness_projects)**：存储所有健身项目的基本信息和目标设置
2. **项目进度记录表 (progress_records)**：存储每个项目的进度历史记录
3. **提醒设置表 (reminders)**：存储所有提醒设置，包括每日提醒和个体项目提醒
4. **成就表 (achievements)**：存储用户已解锁的成就信息
5. **统计数据表 (statistics)**：存储用户的总体统计数据
6. **周统计数据表 (weekly_stats)**：存储用户的周统计数据
7. **月统计数据表 (monthly_stats)**：存储用户的月统计数据

### 5.3 存储策略
1. localStorage用于存储简单的键值对配置信息，提供快速访问
2. IndexedDB用于存储复杂的数据结构和关联数据，提供高效的查询和更新能力
3. 所有数据存储在浏览器本地，确保数据安全性和隐私性
4. 使用Dexie.js提供更好的类型安全性和简化的API
5. 实现数据库迁移策略，确保应用版本升级时数据的完整性和一致性
6. 重要数据变更时进行备份，防止数据丢失

## 6. UI/UX架构

### 6.1 主要界面

#### 1. 主界面（首页）
- 布局：底部导航栏主导的主页面
- 功能：
  - 显示进行中的健身项目卡片列表
  - 提供快速添加新项目的浮动按钮
  - 展示今日提醒和成就通知
  - 顶部搜索栏用于快速查找项目
- 设计要点：
  - 卡片式设计展示项目概览
  - 不同项目类型使用不同颜色标识
  - 快速操作按钮（开始、完成等）

#### 2. 项目详情界面
- 布局：项目详细信息展示页
- 功能：
  - 显示项目完整信息（名称、描述、目标等）
  - 提供实时跟踪操作界面
  - 展示历史完成记录
  - 提供编辑和删除功能
- 设计要点：
  - 根据项目类型（Sets×Reps 或 Total count/weight）显示不同界面
  - 直观的进度可视化（进度条、环形图等）
  - 快速操作按钮（开始、暂停、完成）

#### 3. 项目创建/编辑界面
- 布局：表单输入页面
- 功能：
  - 提供两种项目模式的创建向导
  - 表单验证和错误提示
  - 保存和取消操作
- 设计要点：
  - 分步骤引导用户完成创建
  - 模式切换选项卡
  - 实时预览创建结果

#### 4. 成长记录界面
- 布局：数据可视化展示页面
- 功能：
  - 展示用户健身统计数据
  - 显示已解锁成就
  - 提供图表展示（周/月统计）
- 设计要点：
  - 图表可视化（柱状图、折线图等）
  - 时间筛选器（周、月、年）
  - 成就展示墙

#### 5. 提醒设置界面
- 布局：设置页面
- 功能：
  - 设置每日固定时间提醒
  - 管理个体项目提醒
  - 开启/关闭提醒功能
- 设计要点：
  - 时间选择器
  - 列表展示所有提醒设置
  - 开关控件控制启用状态

#### 6. 设置界面
- 布局：设置页面
- 功能：
  - 用户偏好配置（主题、语言等）
  - 应用设置（通知、自动保存等）
  - 数据管理（备份、导出等）
- 设计要点：
  - 分类设置项
  - 直观的开关和选择控件

### 6.2 导航结构

#### 1. 底部导航栏
- 首页：主界面，显示项目列表
- 记录：成长记录界面，展示统计数据和成就
- 提醒：提醒设置界面
- 设置：应用设置界面

#### 2. 页面间跳转关系
- 主界面 → 项目详情界面（点击项目卡片）
- 主界面 → 项目创建界面（浮动按钮）
- 项目详情界面 → 项目编辑界面（编辑按钮）
- 项目详情界面 → 主界面（返回按钮）
- 各界面 → 设置界面（通过底部导航栏）
- 使用React Router管理页面路由

#### 3. 特殊导航
- 项目创建界面支持步骤导航（上一步/下一步）
- 设置界面内部使用列表导航到子设置页面
- 支持浏览器前进/后退导航

### 6.3 交互设计原则

#### 1. 用户体验原则
- 简洁直观：界面设计简洁，功能一目了然
- 快速反馈：用户操作后立即提供视觉反馈
- 一致性：保持整个应用的视觉和交互一致性
- 可访问性：支持不同设备尺寸和辅助功能

#### 2. 视觉设计规范
- 主色调：活力橙色（#FF6B35）代表活力和动力
- 辅助色：深灰色（#333333）用于文字和重要元素
- 背景色：浅灰色（#F5F5F5）提供舒适的视觉体验
- 字体：使用系统默认字体，确保可读性

#### 3. 响应式设计
- 适配不同屏幕尺寸（手机、平板）
- 支持横竖屏切换
- 触控友好的按钮和控件尺寸

### 6.4 原型设计说明

#### 1. 交互流程
- 项目创建流程：首页 → 创建界面 → 填写表单 → 保存 → 返回首页
- 项目跟踪流程：首页 → 项目详情 → 开始跟踪 → 实时更新 → 完成
- 数据查看流程：首页 → 记录界面 → 选择时间范围 → 查看图表

#### 2. 动效设计
- 页面切换使用淡入淡出效果
- 按钮点击使用CSS过渡效果
- 数据更新使用平滑过渡动画

通过以上UI/UX架构设计，我们可以确保应用具有良好的用户体验和直观的界面设计，满足用户在健身活动监控方面的需求。

## 7. 关键流程设计

### 7.1 项目创建流程
1. 用户点击主界面的"添加项目"按钮
2. 进入项目创建界面，选择项目模式（Sets×Reps 或 Total count/weight）
3. 根据选择的模式显示相应的表单字段
4. 用户填写项目信息（名称、描述、目标等）
5. 表单验证，如有错误则显示错误提示
6. 用户点击保存按钮
7. 数据存储模块将项目数据保存到Room数据库
8. 返回主界面，新创建的项目显示在列表中

### 7.2 实时跟踪流程
1. 用户在主界面点击某个项目卡片进入详情界面
2. 根据项目类型显示相应的跟踪界面
3. 用户点击"开始"按钮开始跟踪
4. 界面显示实时计数器和操作按钮
5. 用户通过按钮或手势操作更新计数
6. 界面实时更新进度显示
7. 用户可随时暂停、继续或完成跟踪
8. 完成后，数据存储模块更新数据库中的项目数据和历史记录

### 7.3 提醒处理流程
1. 应用启动时，提醒通知模块加载提醒设置
2. 系统定时检查是否有触发的提醒
3. 当提醒时间到达时：
   - 创建通知并显示给用户
   - 根据提醒类型执行相应操作
4. 用户点击通知后：
   - 打开相应界面（主界面或项目详情界面）
   - 如有需要，自动开始相关项目跟踪
5. 用户可在提醒设置界面管理所有提醒

### 7.4 数据展示流程
1. 用户进入成长记录界面
2. 界面加载用户成就和统计数据
3. 根据用户选择的时间范围筛选数据
4. 使用图表库渲染统计数据可视化
5. 显示已解锁的成就列表
6. 用户可点击成就查看详细信息
7. 提供数据导出功能

## 8. 性能优化考虑

### 8.1 数据加载优化
- 实现数据懒加载，只加载当前需要显示的数据
- 对大型数据集进行分页处理
- 使用内存缓存机制，避免重复读取文件

### 8.2 内存使用优化
- 及时释放不需要的对象引用
- 使用对象池技术管理频繁创建和销毁的对象
- 优化图片资源使用，按需加载和释放

### 8.3 异步处理优化
- 所有数据库操作在Web Worker中执行
- 使用Promise/async-await处理异步任务，避免阻塞主线程
- 实现任务优先级管理，确保关键任务优先执行

### 8.4 界面响应优化
- 使用React Virtualized优化长列表渲染性能
- 实现代码分割和懒加载，提升页面切换体验
- 优化DOM结构，减少重排重绘

### 8.5 存储优化
- 定期清理过期或无用的数据
- 实现数据压缩机制，减小存储空间占用
- 使用增量更新减少文件写入频率

## 9. 安全性和隐私保护

### 9.1 数据安全
- 所有数据存储在浏览器本地，防止其他网站访问
- 敏感数据进行加密存储（如需要）
- 实现数据备份和恢复机制

### 9.2 隐私保护
- 明确告知用户数据收集和使用方式
- 提供数据删除功能
- 遵守相关隐私法规要求

## 10. 测试策略

### 10.1 单元测试
- 对核心业务逻辑进行单元测试
- 测试数据存储和读取功能
- 验证数据模型的正确性
- 使用Jest或Vitest进行测试

### 10.2 UI测试
- 测试主要界面的交互流程
- 验证不同设备尺寸的适配性
- 测试界面响应和动效效果
- 使用Cypress或Playwright进行端到端测试

### 10.3 集成测试
- 测试模块间的集成和数据流转
- 验证提醒功能的完整流程
- 测试数据持久化和恢复功能
- 使用测试服务器验证PWA功能

## 11. 部署和维护

### 11.1 版本管理
- 使用语义化版本控制
- 制定版本更新策略
- 通过服务工作者实现PWA更新机制

### 11.2 错误处理和日志
- 实现统一的错误处理机制
- 记录关键操作日志
- 提供用户反馈渠道
- 使用Sentry或类似工具进行错误监控

### 11.3 性能监控
- 集成性能监控工具
- 监控关键性能指标
- 定期分析和优化性能瓶颈

通过以上完整的架构设计，我们为健身活动监控应用建立了清晰的技术方案和实现路径，确保项目能够高效、稳定地开发和维护。