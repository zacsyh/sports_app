# 健身项目实时跟踪功能用户故事

## 1. 用户角色

### 主要用户
- **健身爱好者**: 定期进行健身锻炼，希望实时跟踪和管理自己的健身进度
- **健身初学者**: 刚开始健身，需要简单易用的工具来建立健身习惯
- **自律性训练者**: 需要实时反馈和激励机制来保持锻炼的连续性

### 次要用户
- **健身教练**: 可能使用该应用来跟踪客户的训练进度
- **健康关注者**: 关注健康数据，希望通过数据了解自己的身体状况

## 2. 功能描述

作为一位健身用户，我希望能够实时跟踪健身项目的进度，以便我可以及时了解自己的锻炼情况并保持动力。应用基于Web平台（PWA），所有数据存储在本地浏览器中。

### 核心功能
1. 用户可以从项目详情页面点击"开始"按钮进入实时跟踪界面
2. 界面根据项目类型（Sets×Reps 或 Total count/weight）显示相应的跟踪控件
3. 对于Sets×Reps模式：
   - 显示当前组数和目标组数
   - 提供计数器控件来记录每组完成的次数
   - 提供完成当前组和跳过当前组的按钮
4. 对于Total count/weight模式：
   - 显示当前完成次数和目标次数
   - 提供计数器控件来增加完成次数
   - 提供重量输入框来记录使用的重量（可选）
5. 实时显示进度百分比和可视化进度条
6. 提供暂停/继续和结束跟踪的按钮
7. 在跟踪过程中自动保存进度数据

## 3. 验收标准

### 功能验收标准
1. 用户可以从项目详情页面成功进入实时跟踪界面
2. 界面能正确识别项目类型并显示相应跟踪控件
3. Sets×Reps模式功能正常：
   - 能正确显示当前组数和目标组数
   - 计数器控件能正确记录每组完成的次数
   - 完成当前组和跳过当前组按钮功能正常
4. Total count/weight模式功能正常：
   - 能正确显示当前完成次数和目标次数
   - 计数器控件能正确增加完成次数
   - 重量输入框能正确记录使用的重量
5. 进度百分比和可视化进度条能正确显示当前进度
6. 暂停/继续和结束跟踪按钮功能正常
7. 在跟踪过程中能自动保存进度数据
8. 结束跟踪后能正确返回项目详情页面并更新进度

### 性能验收标准
1. 实时跟踪界面加载时间不超过1秒
2. 进度更新响应时间不超过100毫秒
3. 自动保存操作完成时间不超过500毫秒

### 兼容性验收标准
1. 在主流浏览器（Chrome、Firefox、Safari、Edge）上都能正常显示和操作
2. 在深色和浅色主题下都能正确显示界面元素
3. 在不同屏幕尺寸和分辨率下都能正常显示（响应式设计）

## 4. 技术要求

### 数据模型
根据系统架构设计，实时跟踪功能需要处理以下数据，数据存储在浏览器的IndexedDB中：

#### Sets×Reps模式跟踪数据
- `currentSet`: Int (当前组数，从1开始)
- `repsCompletedInCurrentSet`: Int (当前组已完成次数)
- `completedSets`: List<Int> (已完成的组数记录，记录每组实际完成次数)

#### Total count/weight模式跟踪数据
- `currentCount`: Int (当前完成次数)
- `currentWeight`: Double (当前使用的重量)

#### 跟踪会话数据
- `sessionId`: String (会话ID)
- `projectId`: String (项目ID)
- `startTime`: Long (开始时间)
- `endTime`: Long (结束时间)
- `isPaused`: Boolean (是否暂停)
- `pauseTime`: Long (暂停时间)

### 存储要求
1. 跟踪过程中的临时数据应存储在内存中
2. 跟踪结束后的进度数据应保存到浏览器IndexedDB的progress_records表中
3. 所有数据库操作应在Web Worker中执行，避免阻塞主线程
4. 数据库操作应通过数据存储模块统一处理
5. 支持PWA离线存储，确保应用在离线状态下仍可正常使用

### 架构要求
1. 实时跟踪功能应集成在健身项目跟踪模块中
2. 数据处理逻辑应封装在业务逻辑层
3. 数据存储操作应通过数据存储模块统一处理
4. 使用Promise/async-await处理异步操作
5. 遵循MVVM架构模式

### 安全要求
1. 确保数据访问的安全性
2. 防止数据泄露
3. 遵循隐私保护原则
4. 所有数据存储在浏览器本地，不上传到任何服务器

## 5. 界面设计参考

### 界面布局
#### 顶部导航栏
- 左侧：返回按钮
- 中间：项目名称（如果名称过长则截断并显示省略号）
- 右侧：无

#### 项目信息区域
1. **项目基本信息卡片**
   - 项目名称：标题1 (24sp)
   - 项目类型标识：小标签样式
   - 目标信息：根据项目类型显示相应目标

#### 进度可视化区域
1. **环形进度条**
   - 大小：150dp直径
   - 颜色：活力橙 (#FF6B35)
   - 背景：浅灰色 (#F5F5F5)
   - 中心文字：显示百分比和进度文字

2. **进度文字说明**
   - Sets×Reps模式："已完成2组/共4组"
   - Total count/weight模式："已完成150次/共200次"

#### 跟踪控件区域
1. **Sets×Reps模式控件**
   - 当前组数显示："第2组/共4组"
   - 计数器控件：
     - 减少按钮："-"
     - 次数显示：20
     - 增加按钮："+"
   - 操作按钮：
     - 完成当前组按钮（主要按钮样式）
     - 跳过当前组按钮（次要按钮样式）

2. **Total count/weight模式控件**
   - 计数器控件：
     - 减少按钮："-"
     - 次数显示：50
     - 增加按钮："+"
   - 重量输入框：
     - 标签："重量 (kg)"
     - 输入框：数字输入框（带小数点）

#### 底部操作按钮区域
- 左侧：暂停/继续按钮（文字按钮样式）
- 右侧：
  - 结束跟踪按钮（主要按钮样式）

### 视觉设计规范
#### 颜色规范
- 主色调：活力橙 (#FF6B35) - 用于主要操作按钮和进度条
- 主要文字颜色：深灰 (#333333)
- 次要文字颜色：中灰 (#999999)
- 背景色：浅灰 (#F5F5F5)
- 卡片背景色：白色 (#FFFFFF)
- 暂停按钮颜色：警告黄 (#FFC107)

#### 字体规范
- 项目名称：24px
- 卡片标题：18px
- 正文：16px
- 辅助文字：14px
- 按钮文字：16px
- 计数器数字：32px

#### 间距规范
- 卡片间距：16px
- 卡片内边距：16px
- 元素间距：8px
- 按钮内边距：水平16px，垂直12px

#### 组件样式
1. **卡片**
   - 背景色：#FFFFFF
   - 圆角：8px
   - 阴影：0 2px 4px rgba(0,0,0,0.1)
   - 内边距：16px

2. **环形进度条**
   - 线条宽度：12px
   - 背景色：#F5F5F5
   - 进度色：#FF6B35

3. **计数器控件**
   - 按钮：
     - 背景色：#F5F5F5
     - 文字颜色：#333333
     - 圆角：50%（圆形按钮）
     - 大小：48px
   - 数字显示：
     - 背景色：透明
     - 文字颜色：#333333
     - 文字大小：32px
     - 内边距：16px

4. **按钮**
   - 主要按钮：
     - 背景色：#FF6B35
     - 文字颜色：#FFFFFF
     - 圆角：8px
   - 次要按钮：
     - 背景色：#FFFFFF
     - 边框：1px #FF6B35
     - 文字颜色：#FF6B35
     - 圆角：8px
   - 文字按钮：
     - 背景色：透明
     - 文字颜色：#FF6B35
     - 内边距：8px 水平, 4px 垂直

### 交互设计
1. **页面跳转**
   - 从详情界面进入跟踪界面：页面滑入动画
   - 返回详情界面：页面滑出动画

2. **按钮交互**
   - 按钮点击时有CSS过渡效果
   - 按钮按下时颜色加深10%
   - 禁用按钮时透明度为50%，无点击效果

3. **计数器交互**
   - 点击增加/减少按钮时有视觉反馈
   - 长按增加/减少按钮时可连续增加/减少
   - 计数器数值变化时有平滑动画效果

4. **暂停/继续交互**
   - 点击暂停按钮时显示继续按钮
   - 点击继续按钮时显示暂停按钮
   - 暂停时计数器控件变灰并禁用

### 响应式设计
1. **不同屏幕尺寸适配**
   - 小屏设备：环形进度条适当缩小
   - 大屏设备：保持合适的边距和比例
   - 横竖屏切换：支持自动适配
   - 支持桌面端和移动端显示

2. **深色主题适配**
   - 背景色：#121212
   - 卡片背景色：#1E1E1E
   - 文字颜色相应调整

3. **浏览器兼容性**
   - 支持主流浏览器的响应式设计
   - 在不同浏览器窗口尺寸下保持良好显示效果

### 错误处理
1. **数据保存错误**
   - 显示红色Toast提示
   - 提示文字："进度保存失败，请重试"
   - 提供"重试"按钮

2. **浏览器兼容性问题**
   - 检测浏览器对IndexedDB的支持情况
   - 如果不支持，提示用户升级浏览器
   - 对于部分功能不支持的浏览器，提供降级方案

3. **离线状态处理**
   - 应用支持离线使用
   - 离线时数据自动保存到本地存储
   - 重新联网后数据保持完整

### 成功反馈
1. **跟踪结束**
   - 显示绿色Toast提示："跟踪已完成，进度已保存"
   - 自动返回项目详情界面
   - 项目详情界面进度已更新
   - 数据已保存到浏览器IndexedDB中
   - PWA安装提示可能显示，引导用户安装应用

通过以上详细的用户故事，开发团队可以清晰地理解健身项目实时跟踪功能的需求、设计和技术实现要求，从而高效地完成开发工作。