# 健身项目编辑功能用户故事

## 1. 用户角色

### 主要用户
- **健身爱好者**: 定期进行健身锻炼，希望跟踪和管理自己的健身进度
- **健身初学者**: 刚开始健身，需要简单易用的工具来建立健身习惯
- **自律性训练者**: 需要提醒和激励机制来保持锻炼的连续性

### 次要用户
- **健身教练**: 可能使用该应用来跟踪客户的训练计划
- **健康关注者**: 关注健康数据，希望通过数据了解自己的身体状况

## 2. 功能描述

作为一位健身用户，我希望能够编辑已创建的健身项目，以便我可以修改项目信息、调整目标参数或更新项目描述。应用基于Web平台（PWA），所有数据存储在本地浏览器中。

### 核心功能
1. 用户可以从项目详情界面点击编辑按钮进入项目编辑界面
2. 编辑界面应预填充当前项目的全部信息
3. 用户可以修改项目的基本信息：
   - 项目名称（必填，不超过50个字符）
   - 项目描述（可选）
4. 根据项目类型，用户可以修改相应的参数：
   - Sets×Reps模式：组数（正整数）和每组次数（正整数）
   - Total count/weight模式：目标次数（正整数）和目标重量（可选的正数，最多保留两位小数）
5. 系统会对用户输入进行实时验证，提供即时反馈
6. 用户可以保存修改，保存成功后将返回项目详情界面并显示更新后的项目信息
7. 用户可以取消编辑，取消后将返回项目详情界面，不保存任何更改

## 3. 验收标准

### 功能验收标准
1. 用户可以从项目详情界面成功进入项目编辑界面
2. 编辑界面能正确加载并显示当前项目的所有信息
3. 用户可以修改项目基本信息和模式相关参数
4. 系统能够正确验证用户输入：
   - 项目名称不能为空且不超过50个字符
   - Sets×Reps模式的组数和每组次数必须为正整数
   - Total count/weight模式的目标次数必须为正整数
   - 目标重量必须为正数，最多保留两位小数
5. 当表单验证失败时，系统能显示清晰的错误提示
6. 用户可以成功保存修改，保存后项目详情界面会显示更新后的信息
7. 如果存储失败，系统能显示相应的错误信息
8. 用户可以取消编辑，不保存任何更改并返回项目详情界面

### 性能验收标准
1. 项目编辑界面加载时间不超过1秒
2. 表单验证响应时间不超过200毫秒
3. 项目保存操作完成时间不超过1秒

### 兼容性验收标准
1. 在主流浏览器（Chrome、Firefox、Safari、Edge）上都能正常显示和操作
2. 在深色和浅色主题下都能正确显示界面元素
3. 在不同屏幕尺寸和分辨率下都能正常显示（响应式设计）

## 4. 技术要求

### 数据模型
根据系统架构设计，健身项目的数据模型应包含以下字段，数据存储在浏览器的IndexedDB中：

#### 项目基础信息
- `id`: String (唯一标识符)
- `name`: String (项目名称，必填，不超过50个字符)
- `description`: String (项目描述，可选)
- `type`: Enum (项目类型：SETS_REPS 或 TOTAL_COUNT)
- `createdAt`: Long (创建时间)
- `updatedAt`: Long (更新时间)
- `status`: Enum (状态：ACTIVE, COMPLETED, ARCHIVED)

#### Sets×Reps模式数据结构
- `sets`: Int (设定组数，正整数)
- `repsPerSet`: Int (每组次数，正整数)
- `completedSets`: List<Int> (已完成的组数记录，记录每组实际完成次数)

#### Total count/weight模式数据结构
- `targetCount`: Int (目标次数，正整数)
- `targetWeight`: Double (目标重量，可选，正数，最多保留两位小数)
- `currentCount`: Int (当前完成次数)
- `history`: List<ProgressRecord> (进度历史记录)

### 存储要求
1. 项目数据应存储在浏览器的IndexedDB数据库中
2. 使用Dexie.js封装IndexedDB操作
3. 所有数据库操作应在Web Worker中执行，避免阻塞主线程
4. 数据库操作应通过数据存储模块统一处理
5. 支持PWA离线存储，确保应用在离线状态下仍可正常使用

### 架构要求
1. 项目编辑功能应集成在健身项目管理模块中
2. 数据验证逻辑应封装在业务逻辑层
3. 数据存储操作应通过数据存储模块统一处理
4. 使用Promise/async-await处理异步操作
5. 编辑功能应复用创建项目界面的组件和逻辑，确保一致性

## 5. 界面设计参考

### 界面布局
#### 顶部导航栏
- 左侧：取消按钮
- 中间：标题"编辑项目"
- 右侧：保存按钮

#### 表单区域
1. **项目名称输入框**
   - 类型：单行文本输入框
   - 提示文字："请输入项目名称"
   - 验证：必填，不超过50个字符

2. **项目描述输入框**
   - 类型：多行文本输入框
   - 提示文字："请输入项目描述（可选）"
   - 最大高度：适配内容，最多显示5行

3. **项目类型选择**
   - 类型：选项卡控件（注意：编辑时项目类型不可更改）
   - 选项：
     - "Sets×Reps" (根据当前项目类型激活)
     - "Total count/weight" (根据当前项目类型激活)
   - 交互：显示当前项目类型，但不允许更改

4. **Sets×Reps模式字段**
   - 组数输入框：
     - 类型：数字输入框
     - 提示文字："组数"
     - 验证：必填，正整数
   - 每组次数输入框：
     - 类型：数字输入框
     - 提示文字："每组次数"
     - 验证：必填，正整数

5. **Total count/weight模式字段**
   - 目标次数输入框：
     - 类型：数字输入框
     - 提示文字："目标次数"
     - 验证：必填，正整数
   - 目标重量输入框：
     - 类型：数字输入框（带小数点）
     - 提示文字："目标重量（可选）"
     - 验证：可选，如填写则必须为正数，最多保留两位小数

#### 底部操作按钮区域
- 左侧：取消按钮（次要按钮样式）
- 右侧：保存按钮（主要按钮样式）

### 视觉设计规范
#### 颜色规范
- 主色调：活力橙 (#FF6B35) - 用于主要操作按钮和激活状态
- 主要文字颜色：深灰 (#333333)
- 次要文字颜色：中灰 (#999999)
- 错误提示颜色：错误红 (#F44336)
- 输入框边框：浅灰 (#E0E0E0)
- 输入框背景：白色 (#FFFFFF)

#### 字体规范
- 标题："编辑项目" - 20px
- 表单标签：16px
- 输入框文字：16px
- 错误提示：14px

#### 间距规范
- 表单元素间距：16px
- 输入框内边距：16px
- 按钮内边距：水平16px，垂直12px

#### 组件样式
1. **输入框**
   - 背景色：#FFFFFF
   - 边框：1px #E0E0E0
   - 圆角：8px
   - 内边距：16px
   - 文字颜色：#333333
   - 提示文字颜色：#999999

2. **选项卡**
   - 激活状态：橙色下划线
   - 未激活状态：灰色文字（编辑时为只读状态）

3. **按钮**
   - 主要按钮：
     - 背景色：#FF6B35
     - 文字颜色：#FFFFFF
     - 圆角：8px
   - 次要按钮：
     - 背景色：#FFFFFF
     - 边框：1px #FF6B35
     - 文字颜色：#FF6B35
     - 圆角：8px

### 交互设计
1. **表单验证**
   - 实时验证用户输入
   - 输入框失去焦点时进行验证
   - 验证失败时显示红色边框和错误提示文字
   - 验证成功时显示绿色对勾图标

2. **模式切换**
   - 编辑时项目类型不可更改，仅显示当前项目类型
   - 根据项目类型显示相应字段并预填充数据

3. **按钮交互**
   - 按钮点击时有CSS过渡效果
   - 按钮按下时颜色加深10%
   - 禁用按钮时透明度为50%，无点击效果

4. **页面跳转**
   - 从详情界面进入编辑界面：页面滑入动画
   - 保存成功后返回详情界面：页面滑出动画
   - 取消编辑后返回详情界面：页面滑出动画

### 错误处理
1. **表单验证错误**
   - 在相应输入框下方显示红色错误提示文字
   - 输入框显示红色边框
   - 保存按钮在存在验证错误时禁用

2. **存储错误**
   - 显示红色Toast提示
   - 提示文字："项目保存失败，请重试"
   - 提供"重试"按钮

3. **浏览器兼容性问题**
   - 检测浏览器对IndexedDB的支持情况
   - 如果不支持，提示用户升级浏览器
   - 对于部分功能不支持的浏览器，提供降级方案

### 成功反馈
1. **保存成功**
   - 显示绿色Toast提示："项目更新成功"
   - 自动返回项目详情界面
   - 详情界面显示更新后的项目信息
   - 数据已保存到浏览器IndexedDB中
   - PWA安装提示可能显示，引导用户安装应用

通过以上详细的用户故事，开发团队可以清晰地理解健身项目编辑功能的需求、设计和技术实现要求，从而高效地完成开发工作。